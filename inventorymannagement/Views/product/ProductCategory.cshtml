@using System;
@using System.Data;
@{
    ViewBag.Title = "ProductCategory";
    var data = ViewBag.catdat as System.Data.DataTable;
    int i = 1;


}

@{
    string Category = "";
    string cat_id = "0";

    DataTable editdata = ViewBag.editdata as System.Data.DataTable;

    if (ViewBag.id != null && editdata != null && editdata.Rows.Count > 0)
    {
        DataRow row = editdata.Rows[0]; // ✅ correct
        cat_id = row["Category_id"].ToString();
        Category = row["CATEGORY_NAME"].ToString(); // ✅ check correct column name
    }
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<style>
    body {
        font-family: 'Segoe UI', sans-serif;
        background: #f9f9f9;
        margin: 0;
        padding: 0;
    }

    .container {
        padding: 20px 40px;
    }

    h2 {
        margin-bottom: 20px;
    }

    .main-content {
        display: flex;
        gap: 20px;
    }

    /* Left Form Section */
    .test-form {
        background: #e8fdf6;
        padding: 20px;
        border-radius: 8px;
        flex: 1;
        min-width: 300px;
    }

        .test-form h3 {
            margin-bottom: 15px;
        }

        .test-form form {
            display: flex;
            flex-direction: column;
        }

        .test-form label {
            margin-top: 10px;
            font-weight: bold;
        }

        .test-form input[type="text"],
        .test-form input[type="file"] {
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

    .image-preview {
        margin: 15px 0;
    }

        .image-preview img {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            border: 3px solid #2fa68d;
        }

    .test-form button {
        background: #006400;
        color: white;
        padding: 10px;
        border: none;
        margin-top: 10px;
        border-radius: 5px;
        cursor: pointer;
    }

    /* Right Table Section */
    .test-list {
        background: #e8fdf6;
        padding: 20px;
        border-radius: 8px;
        flex: 2;
        overflow-x: auto;
    }

        .test-list h3 {
            margin-bottom: 15px;
        }

    table {
        width: 100%;
        border-collapse: collapse;
        background: white;
    }

        table th,
        table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

    .table-img {
        width: 40px;
        height: 40px;
        border-radius: 5px;
    }

    .edit-btn {
        background: #007bff;
        color: white;
        padding: 5px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
</style>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Product Category</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
</head>
@*<link href="~/styling/features.css" rel="stylesheet" />*@
<body>
    <div class="container" id="main">
        <h2>Add Category</h2>
        <div class="main-content">
            <!-- Left Section: Test Form -->
            <div class="test-form">
                <h3>Category</h3>
                <form>
                    <label>Category *</label>
                    <input type="text" id="ProCat" value="@Category" placeholder="Enter test category" required>
                    <input type="hidden" id="ProCatid" value="@cat_id">
                    @if (cat_id=="0")
                    {
                        <button type="submit" onclick="saverecord()">Add Category</button>
                    }else
                    {
                        <button type="submit" onclick="updaterecord()">Update Category</button>
                    }
                </form>
            </div>

            <!-- Right Section: Test List -->
            <div class="test-list" id="sub">
                <h3>Category List</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Sr.No.</th>
                            <th>Category Name</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (System.Data.DataRow row in data.Rows)
                        {
                            <tr>
                                <td>@i</td>
                                <td>@row["CATEGORY_NAME"]</td>
                                <td>
                                    <a href="/product/ProductCategory?id=@row["Category_id"]" class="btn btn-warning edit-button">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <!-- Delete Button -->
                                    <button class="delete-button" data-id="@row["Category_id"]">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </td>
                            </tr>
                            i++;
                        }
                        @*<tr>
                                <td>1</td>
                                <td>Blood Test</td>
                                <td><button class="edit-btn">✏️ Edit</button></td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>X-Ray</td>
                                <td><button class="edit-btn">✏️ Edit</button></td>
                            </tr>*@
                        <!-- More rows... -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>
<script src="~/Scripts/jquery-3.7.0.min.js"></script>
<script>
    function saverecord() {
        //e.preventDefault();
        debugger;
        const Category = document.getElementById('ProCat').value;
        // Validations (as you've written)
        if (Category === '') { alert("Please enter your Category name!"); return; }

        const items = {
            Category: Category,
        };

        $.ajax({
            url: '/product/ProductCategory',
            type: 'POST',
            data: items,
            success: function (data) {
                //$('#result').html(data.message || "Insert successful!");
                //alert("Insert Successful!");
                //window.location.reload();  
                const message = data.message || data; // support both object or string

                if (message.startsWith("Success")) {
                    $('#result').html(message);
                    alert("Insert Successful!");
                    window.location.reload();
                } else if (message.startsWith("Error")) {
                    $('#result').html(message);
                    alert(message); // e.g., "Error-Category name already exists"
                } else {
                    $('#result').html("Unexpected response.");
                    alert("Something went wrong!");
                }
            },
            //success: function (data) {
            //    $('#result').html(data.message || "insert successful!");
            //    alert("insert Successful!");
            //    window.location.reload();
            //},
            error: function (xhr, status, error) {
                console.error("Error:", error);
            }
        });        
    }
    function updaterecord() {
        //e.preventDefault();
        debugger;
        const Category = document.getElementById('ProCat').value;
        // Validations (as you've written)
        if (Category === '') { alert("Please enter your Category name!"); return; }

        const items = {
            Category_id: document.getElementById('ProCatid').value,
            Category: Category,
        };

        $.ajax({
            url: '/product/UPDATE',
            type: 'POST',
            data: items,  
            success: function (data) {
                $('#result').html(data.message || "Registration successful!");
                Swal.fire({
                    title: "Registration",
                    text: "Successful!!",
                    icon: "success"
                });

                //window.location.href = "/abc/dashboard";
            },
            error: function (xhr, status, error) {
                console.error("Error:", error);
            }
        });
    }

    $(document).ready(function () {
        $('.delete-button').click(function () {
            const id = $(this).data('id');

            if (confirm('Are you sure you want to delete this record?')) {
                $.ajax({
                    url: '/product/delete', // Change to match your route
                    type: 'POST',
                    data: { id: id },
                    success: function (response) {
                        alert('Record deleted successfully.');
                        location.reload(); // Refresh the page or remove row manually
                    },
                    error: function (xhr, status, error) {
                        alert('Error deleting record: ' + error);
                    }
                });
            }
        });
    });

</script>


